<?xml version="1.0" encoding="UTF-8"?>

<!-- 具体配置可参考这个博客 https://blog.csdn.net/inke88/article/details/75007649 -->
<configuration scan="true" scanPeriod="60 seconds" debug="false">
    <property name="appname" value="wx_minapp"/>
    <!--<property name="logfile" value="d:\\tmp\\${appname}.log"/>-->
    <property name="logfile" value="./log/${appname}.log"/>

    <contextName>${appname}</contextName>
    
    <!--输出到控制台 ConsoleAppender-->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <!--展示格式 layout-->
        <layout class="ch.qos.logback.classic.PatternLayout">
            <pattern>%d{yyyy-MM-dd HH:mm:ss} %-5level %logger{36} %X# %msg%n</pattern>
        </layout>
    </appender>

    <!--日志名称，如果没有File 属性，那么只会使用FileNamePattern的文件路径规则
        如果同时有<File>和<FileNamePattern>，那么当天日志是<File>，明天会自动把今天
        的日志改名为今天的日期。即，<File> 的日志都是当天的。
    -->
    <appender name="rollingFile" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <File>${logfile}</File>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!--文件路径,定义了日志的切分方式——把每一天的日志归档到一个文件中,以防止日志填满整个磁盘空间-->
            <!--<fileNamePattern>${logfile}.%d{yyyy-MM-dd}.%i</fileNamePattern>-->
            <fileNamePattern>${logfile}.%d{yyyy-MM-dd}.%i.zip</fileNamePattern>
            <!--每个日志文件大小限制-->
            <maxFileSize>1000MB</maxFileSize>
            <!--<maxFileSize>10000KB</maxFileSize>-->
            <!--只保留最近90天的日志-->
            <maxHistory>90</maxHistory>
        </rollingPolicy>
        <encoder>
            <charset>UTF-8</charset>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} %-5level %logger{36} %X＃ %msg%n</pattern>
        </encoder>
    </appender>

     <!--    异步输出日志到文件     -->
    <appender name="ASYNC-INFO" class="ch.qos.logback.classic.AsyncAppender">
        <!-- 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 -->
        <discardingThreshold>0</discardingThreshold>
        <!-- 更改默认的队列的深度,该值会影响性能.默认值为256 -->
        <queueSize>256</queueSize>
        <!-- 添加附加的appender,最多只能添加一个 -->
        <appender-ref ref="rollingFile"/>
    </appender>

    <!--指定最基础的日志输出级别-->
    <springProfile name="dev">
        <!--<include resource="org/springframework/boot/logging/logback/console-appender.xml" />-->
        <root level="DEBUG">
            <appender-ref ref="console" />
        </root>
    </springProfile>

    <springProfile name="test">
        <root level="INFO">
            <appender-ref ref="ASYNC-INFO" />
        </root>
    </springProfile>

    <springProfile name="prod">
        <root level="INFO">
            <appender-ref ref="ASYNC-INFO" />
        </root>
    </springProfile>
</configuration>